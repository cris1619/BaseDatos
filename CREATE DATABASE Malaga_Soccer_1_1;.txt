CREATE DATABASE mgr_play;
USE mgr_play;

CREATE TABLE admin (
id_admin BIGINT PRIMARY KEY,
nombre VARCHAR(100) NOT NULL,
apellido VARCHAR(100) NOT NULL,
correo VARCHAR(100) UNIQUE NOT NULL,
contraseña VARCHAR(100) NOT NULL
);

CREATE TABLE ubicaciones (
id_ubicacion INT AUTO_INCREMENT PRIMARY KEY,
municipio VARCHAR(100) NOT NULL,
cancha VARCHAR(100),
);

CREATE TABLE canchas (
id_cancha INT AUTO_INCREMENT PRIMARY KEY,
nombre_cancha VARCHAR(100) NOT NULL,
direccion VARCHAR(100),
id_ubicacion INT NOT NULL,                         
FOREIGN KEY (id_ubicacion) REFERENCES ubicaciones(id_ubicacion)
)

CREATE TABLE torneos (
id_torneo INT AUTO_INCREMENT PRIMARY KEY,
id_admin BIGINT NOT NULL,
nombre_torneo VARCHAR(100) NOT NULL,
descripcion_torneo TEXT,
estado_torneo ENUM('Programado', 'En curso', 'Finalizado') DEFAULT 'Programado',
tipo_torneo ENUM('Fase_De_Grupos', 'Eliminatorias', 'Liguilla') DEFAULT 'Fase_De_Grupos',
fecha_inicio DATE NOT NULL,
fecha_fin DATE NOT NULL,
id_ubicacion INT NOT NULL,
reglas TEXT,
numero_equipos INT NOT NULL,
premio DECIMAL(10,2),
FOREIGN KEY (id_ubicacion) REFERENCES ubicaciones(id_ubicacion),
FOREIGN KEY (id_admin) REFERENCES admin(id_admin)
);

CREATE TABLE torneo_admin (
id_torneo INT NOT NULL,
id_admin BIGINT NOT NULL,
PRIMARY KEY (id_torneo, id_admin),
FOREIGN KEY (id_torneo) REFERENCES torneos(id_torneo),
FOREIGN KEY (id_admin) REFERENCES admin(id_admin)
);

CREATE TABLE equipos (
id_equipo INT AUTO_INCREMENT PRIMARY KEY,
nombre_equipo VARCHAR(100) NOT NULL,
escudo VARCHAR(255),
entrenador VARCHAR(100),
id_ubicacion INT,
Estado ENUM('Activo', 'Inactivo') DEFAULT 'Activo',
FOREIGN KEY (id_ubicacion) REFERENCES ubicaciones(id_ubicacion)
);

CREATE TABLE equipo_torneo (
id_equipo INT NOT NULL,
id_torneo INT NOT NULL,
PRIMARY KEY (id_equipo, id_torneo),
FOREIGN KEY (id_equipo) REFERENCES equipos(id_equipo),
FOREIGN KEY (id_torneo) REFERENCES torneos(id_torneo)
);

CREATE TABLE jugadores (
id_jugador INT AUTO_INCREMENT PRIMARY KEY,
nombre_jugador VARCHAR(100) NOT NULL,
apellido_jugador VARCHAR(100) NOT NULL,
posicion VARCHAR(50) NOT NULL,
fecha_nacimiento DATE NOT NULL,
altura DECIMAL(5,2) NOT NULL,
Peso DECIMAL(5,2) NOT NULL,
estado ENUM('Activo', 'Lesionado', 'Suspendido') DEFAULT 'Activo' NOT NULL,
id_equipo INT NOT NULL,
FOREIGN KEY (id_equipo) REFERENCES equipos(id_equipo)
);

CREATE TABLE clasificacion (
id_clasificacion INT AUTO_INCREMENT PRIMARY KEY,
id_Torneo INT NOT NULL,
id_equipo INT NOT NULL,
partidos_jugados INT DEFAULT 0,
partidos_ganados INT DEFAULT 0,
partidos_empatados INT DEFAULT 0,
partidos_perdidos INT DEFAULT 0,
goles_Favor INT DEFAULT 0,
goles_Contra INT DEFAULT 0,
diferencia_goles INT GENERATED ALWAYS AS (goles_Favor - goles_Contra) STORED,
puntos INT DEFAULT 0,
FOREIGN KEY (id_torneo) REFERENCES torneos(id_torneo),
FOREIGN KEY (id_equipo) REFERENCES equipos(id_equipo),
UNIQUE (id_torneo, id_equipo)
);

CREATE TABLE partido (
id_partido INT AUTO_INCREMENT PRIMARY KEY,
fecha DATE NOT NULL,
hora TIME NOT NULL,
id_ubicacion INT NOT NULL,
id_cancha INT NOT NULL,
id_torneo INT NOT NULL,
FOREIGN KEY (id_ubicacion) REFERENCES ubicaciones(id_ubicacion),
FOREIGN KEY (id_cancha) REFERENCES canchas(id_cancha),
FOREIGN KEY (id_torneo) REFERENCES torneos(id_torneo)
);

CREATE TABLE partido_equipo (
id_partido INT NOT NULL,
id_equipo INT NOT NULL,
PRIMARY KEY (id_partido, id_equipo),
FOREIGN KEY (id_partido) REFERENCES partidos(id_partido),
FOREIGN KEY (id_equipo) REFERENCES equipos(id_equipo)
);



-- jugadores inscritos en un torneo
CREATE TABLE jugador_torneo (
id_jugador INT NOT NULL,
id_torneo INT NOT NULL,
PRIMARY KEY (id_jugador, id_torneo),
FOREIGN KEY (id_jugador) REFERENCES jugador(id_jugador),
FOREIGN KEY (id_torneo) REFERENCES torneos(id_torneo)
);

-- Participación del jugador en partidos
CREATE TABLE jugador_partido (
id_jugador INT NOT NULL,
id_partido INT NOT NULL,
goles INT DEFAULT 0,
asistencias INT DEFAULT 0,
Tarjetas ENUM('Ninguna', 'Amarilla', 'Roja') DEFAULT 'Ninguna',
PRIMARY KEY (id_jugador, id_partido),
FOREIGN KEY (id_jugador) REFERENCES jugadores(id_jugador),
FOREIGN KEY (id_partido) REFERENCES partidos(id_partido)
);

-- Árbitros
CREATE TABLE arbitros (
id_arbitro INT AUTO_INCREMENT PRIMARY KEY,
Nombre VARCHAR(100),
Apellido VARCHAR(100)
);

CREATE TABLE arbitro_partido (
    id_arbitro INT NOT NULL,
    id_partido INT NOT NULL,
    Rol ENUM('Principal', 'Asistente', 'Cuarto Árbitro') DEFAULT 'Principal',
    PRIMARY KEY (id_arbitro, id_partido),
    FOREIGN KEY (id_arbitro) REFERENCES arbitros(id_arbitro),
    FOREIGN KEY (id_partido) REFERENCES partidos(id_partido)
);

-- Eventos durante los partidos
CREATE TABLE evento_partido (
Id_Evento INT AUTO_INCREMENT PRIMARY KEY,
id_partido INT NOT NULL,
id_jugador INT NOT NULL,
minuto INT NOT NULL,
tipo ENUM('Gol', 'Asistencia', 'Cambio', 'Tarjeta Amarilla', 'Tarjeta Roja'),
FOREIGN KEY (id_partido) REFERENCES partidos(id_partido),
FOREIGN KEY (id_jugador) REFERENCES jugadores(id_jugador)
);

-- Estadísticas acumuladas por torneo
CREATE TABLE estadisticas_jugador (
id_jugador INT NOT NULL,
id_torneo INT NOT NULL,
partidos_jugados INT DEFAULT 0,
goles INT DEFAULT 0,
asistencias INT DEFAULT 0,
tarjetas_amarillas INT DEFAULT 0,
tarjetas_rojas INT DEFAULT 0,
PRIMARY KEY (id_jugador, id_torneo),
FOREIGN KEY (id_jugador) REFERENCES jugadores(id_jugador),
FOREIGN KEY (id_torneo) REFERENCES torneos(id_torneos)
);

